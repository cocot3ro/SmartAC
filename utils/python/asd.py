#!/usr/bin/env python3
"""
parse_1H9L.py

Entrada: lista `csv_lines` (cada item: string "CSV:+297000,-1665,+829,-830,...")
Salida: para cada trama:
 - bloques de (1H + 9L)
 - bits extraidos por bloque (clasificados short/long -> 0/1)
 - secuencia de bits completa y bytes en LSB-first / MSB-first

Ajusta BASE_US y TOLERANCE si tu unidad difiere (ej 830us).
"""
import re
import numpy as np
from collections import Counter

# ---------------------------
# EDITA: pega aquí tus tramas CSV
# ---------------------------
csv_lines = [
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+1660,-830,+830,-2490,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+2490,-830,+1660,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-3320,+1660,-2490,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+830,-830,+1660,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-830,+1660,-2490,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-1660,+1660,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+2490,-2490,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-2490,+1660,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+3320,-2490,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+3320,-830,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-4980,+830,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+1660,-830,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-2490,+830,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-830,+830,-830,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+830,-1660,+830,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-1660,+830,-830,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+1660,-1660,+830,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+2490,-1660,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-3320,+830,-830,+830,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+830,-1660,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-830,+830,-830,+830,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-2490,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+1640,-830,+830,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-2490,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+2490,-830,+830,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+4150,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-4150,+1660,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+2490,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-1660,+1660,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-830,+1660,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+830,-830,+1660,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-1660,+1660,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+1660,-830,+1660,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+2490,-830,+830,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-3320,+2490,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+830,-830,+830,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-830,+2490,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-1660,+830,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+3320,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-2490,+830,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+4150,-1660,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+3320,-3320",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-5810,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+1660,-3320",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-3320,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-830,+830,-3320",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+830,-2490,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-1660,+830,-3320",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+1660,-2490,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+2490,-4150",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-3320,+830,-1660,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+830,-4150",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-830,+830,-1660,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-4980",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+1660,-1660,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-5810",
    "+301982,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+2490,-1660,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830",
    "+301149,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-4150,+830,-830,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-1660,+830,-830,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+830,-830,+830,-830,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+2490,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-3320,+1660,-830,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+830,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-830,+1660,-830,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+2490,-830,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+3320,-830,+830,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+3320,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-4980,+1660,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+1660,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-2490,+1660,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-830,+830,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+830,-1660,+1660,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-1660,+830,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+1660,-1660,+1660,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+2490,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-3320,+830,-830,+1660,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-830,+830,-830,+1660,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+1660,-830,+1660,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-3320",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-4150,+2490,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+2490,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-4150,+2490,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+2490,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-1660,+2490,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-830,+1660,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+830,-830,+2490,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-1660,+1660,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+1660,-830,+2490,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+2490,-830,+830,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-3320,+3320,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+830,-830,+830,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-830,+3320,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-1660,+830,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+4150,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-2490,+830,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+4980,-830,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+3320,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-6640,+1660,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+1660,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-4150,+1660,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-830,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+830,-3320,+1660,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-1660,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+1660,-3320,+1660,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+2490,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-3320,+830,-2490,+1660,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+830,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-1660,+830,-830,+830,-2490,+1660,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-3320",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-2490,+1660,-2490,+1660,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-4150",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-4150,+830,-1660,+1660,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+3320,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+1660,-830,+830,-830,+830,-830,+830,-4150,+830,-1660,+1660,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+3320,-830",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-2490,+830,-2490,+2490,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+830,-1660,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-1660,+1660,-2490,+2490,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-2490,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-3320,+830,-1660,+2490,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-3320,+830,-1660",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-2490,+1660,-1660,+2490,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-830,+2490,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-1660,+2490,-1660,+2490,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-830,+1660,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-4150,+830,-830,+2490,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-1660,+1660,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-1660,+830,-1660,+830,-830,+2490,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+2490,-830,+830,-2490",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-1660,+830,-830,+1660,-830,+2490,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+3320,-3320",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-4980,+3320,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+830,-1660,+830,-3320",
    "+295000,-1660,+830,-830,+830,-830,+830,-830,+1660,-6640,+1660,-3320,+830,-3320,+830,-3320,+830,-830,+830,-1660,+830,-1660,+830,-4980,+830,-7470,+830,-7470,+830,-1660,+830,-830,+2490,-830,+1660,-1660,+2490,-830,+3320,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-7470,+830,-830,+1660,-830",
]

# ---------------------------
# Parámetros (ajusta si hace falta)
# ---------------------------
BASE_US = 830.0          # unidad base aprox para normalizar
TOL_REL = 0.30           # tolerancia relativa para redondear a múltiplos
MIN_PULSE_US = 300       # ignorar pulsos más cortos de ruido
# número de bajos por celda (según observación)
LOWS_PER_CELL = 9

# ---------------------------
# funciones auxiliares
# ---------------------------
def parse_csv(line):
    s = line.strip()
    if s.startswith("CSV:") or s.startswith('"CSV:'):
        s = s.split("CSV:")[-1].strip().strip('"')
    parts = [p.strip() for p in s.split(",") if p.strip()]
    vals = [int(x) for x in parts]
    # devolver lista de (level, dur) usando convención: + = HIGH, - = LOW
    return [ (1 if v>0 else 0, abs(v)) for v in vals ]

def norm_mult(us):
    # redondea a múltiplos de BASE_US si entra en tolerancia, devuelve entero múltiplo (n)
    if us < MIN_PULSE_US:
        return None
    n = int(round(us / BASE_US))
    if n < 1: n = 1
    if abs(us - n*BASE_US) / (n*BASE_US) <= TOL_REL:
        return n
    else:
        return None

def chunk_into_cells(pulses):
    # pulses: list de (lvl,dur) transiciones. Buscamos patrón 1H, then 9 lows.
    cells = []
    i = 0
    N = len(pulses)
    while i < N:
        # buscar una transición de HIGH que marque inicio (nivel=1)
        lvl, d = pulses[i]
        if lvl == 1:
            # intentar recoger 1H + 9L siguientes
            if i + 1 + LOWS_PER_CELL <= N:
                block = pulses[i:i+1+LOWS_PER_CELL]
                # comprobar que estructura coincide: first high, luego LOWS_PER_CELL of low
                if block[0][0] == 1 and all(b[0] == 0 for b in block[1:]):
                    cells.append(block)
                    i += 1 + LOWS_PER_CELL
                    continue
        i += 1
    return cells

def classify_lows(block):
    # block: list (1H, then 9 lows). Queremos convertir las 9 lows a bits.
    lows = block[1:]
    mults = [norm_mult(d) for (_,d) in lows]
    # si algún mult es None, conservamos el valor crudo para retorno
    return mults

def mults_to_bits(mults):
    # heurística simple: 1 -> short (0), 2 -> long (1), >2 -> mapear a series
    bits = []
    for m in mults:
        if m is None:
            bits.append(None)
        else:
            # simple threshold: even multiples = 0, odd multiples = 1 (ejemplo)
            # mejor: 1->0,2->1,3->?? ; aquí usamos: 1->0,2->1,>=3 -> map a 1
            if m == 1:
                bits.append(0)
            elif m == 2:
                bits.append(1)
            else:
                bits.append(1)
    return bits

def bits_to_bytes(bits, lsb_first=True):
    # bits: lista de 0/1/None -> concatenar y empaquetar en bytes (LSB-first o MSB-first)
    clean = [b for b in bits if b in (0,1)]
    if not clean:
        return []
    bytes_out = []
    # empaquetar de 8 en 8
    for i in range(0, len(clean), 8):
        chunk = clean[i:i+8]
        val = 0
        for j, bit in enumerate(chunk):
            if lsb_first:
                val |= (bit & 1) << j
            else:
                val = (val << 1) | (bit & 1)
        bytes_out.append(val)
    return bytes_out

# ---------------------------
# Main
# ---------------------------
for idx, line in enumerate(csv_lines):
    pulses = parse_csv(line)
    cells = chunk_into_cells(pulses)
    print(f"\n=== Trama {idx+1}: transiciones={len(pulses)} cells_detected={len(cells)} ===")
    all_bits = []
    per_cell_bits = []
    for ci, cell in enumerate(cells):
        mults = classify_lows(cell)
        bits = mults_to_bits(mults)
        per_cell_bits.append(bits)
        all_bits.extend([b for b in bits if b is not None])
        # imprimir detalle por celda
        print(f"Cell {ci:02d}: lows mults={mults} -> bits={bits}")
    # convertir bits a bytes LSB-first y MSB-first
    bytes_lsb = bits_to_bytes(all_bits, lsb_first=True)
    bytes_msb = bits_to_bytes(all_bits, lsb_first=False)
    print(f"Total bits extraidos (limpios) = {len(all_bits)}")
    print("Bytes LSB-first   :", ["%02X" % b for b in bytes_lsb])
    print("Bytes MSB-first   :", ["%02X" % b for b in bytes_msb])

    # sugerencia: imprimir primer 30 bytes si hay suficientes
    if len(bytes_lsb) >= 30:
        print("Primer 30 bytes (LSB-first):", " ".join("%02X" % b for b in bytes_lsb[:30]))
    else:
        print("No hay suficientes bits para 30 bytes (necesitas más celdas).")

# ---------------------------
# Fin
# ---------------------------
